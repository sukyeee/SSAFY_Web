<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
<!-- CSS -->

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
<!-- Default theme -->

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
<!-- Semantic UI theme -->

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.min.css"/>
<!-- Bootstrap theme -->

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/>
<link rel="stylesheet" href="./css/style.css" type="text/css" />

</head>
<style>
   

</style>
<body>
  <div class="container-fluid">
  	<%@ include file="./header.jsp" %>

    <header>
        <div class="header-main">

            <!-- <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSpBikJfmp4hdfGgW8rF5vhgNYDgv1KE6X1_w&usqp=CAU" alt="" style="width: 95%; height: 400px; margin-top: 2rem; margin-left: 2.5%"> -->
            <img class="header-main-img" src="../img/house.jpg" alt="">
            <div class="header-main-img-black"> </div>
            <div class="main-title">
              <div class="main-title-content">
                <p></p>
              </div>
            </div>
          </img>
            
            <div class="header-menu">
              <!-- <img class = "logo" style="width: 20rem; padding-left: 3rem" src="http://www.newsworker.co.kr/news/photo/202204/153752_169267_517.png" class="card-img-top" alt="..."> -->
            
              <div class="header-menu-right">
                <a href="#">오늘의 뉴스</a>
                <a href="#">공지사항</a>
              </div>
            </div>

        </div>
       
    </header>
    
    <main>
        <div class="main-top">
          
            
         </div>
        
        <div class="main-bottom">
          <div class="row col-md-8 justify-content-center mb-2">
     
             <form class="d-flex">
		      <input class="form-control me-2" id= "searchInputText" type="search" placeholder="검색 하러가기" value="" aria-label="Search" >
              <button type="button" class="btn btn-light" id="searchBtn" onclick="search()">  <a href="./map/mapMain.jsp">🔍</a> </button>
		    </form>
		    
          </div>
        </div>
        
                <!-- 이벤트 상세정보 modal -->
		  <div id="detail-modal" class="modal fade" id="detail-modal" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
		    <div class="modal-dialog">
		      <div class="modal-content">
		        <div class="modal-header">
		          <h5 class="modal-title" id="staticBackdropLabel">상세정보</h5>
		          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		        </div>
		        <div id="modal-body">
		          ...
		        </div>
		        <div class="modal-footer">
		            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        			<button type="button" class="btn btn-primary">Save changes</button>
		        </div>
		      </div>
		    </div>
		  </div>
      
    </main>

    <footer>
    <div id="board-list" class="footer-card">
	    <table class="table table-hover">
	  <tbody>
	<!--      <tr data-eventKey="1">
	      <td>Event1</td>
	      <td>0000.00.00 ~ 0000.00.00</td>
	    </tr>
	    <tr data-eventKey="2">
	      <td>Event2</td>
	      <td>0000.00.00 ~ 0000.00.00</td>
	    </tr>
	    -->
	  </tbody>
	</table>
      
    </div>

  </footer>

  </div>
  <!-- container -->
  </body>

  <script>

	   	function search() {
		     var keyword = document.querySelector("#searchInputText");
			 sessionStorage.setItem("keyword", keyword);
	   	}
  
  
  //////////////////////////////////////////////////////////
  let boardListArr;
  /** = [
		  {
		        name: 'event1', 
		        eventKey:"1",
		        startDateTime: '0000.00.00',
		        endDateTime: '0000.00.00',
		        statusCode: '001',
		        url:"event/event1.html"
		    },
		    {
		    	name: 'event2', 
		        eventKey:"2",
		        startDateTime: '0000.00.00',
			    endDateTime: '0000.00.00',
			    statusCode: '001',
			    url: "event/ddd.html"
		    },
  ];	
  */
  
  window.onload = function(){
	  boardList();
  }
  
  //async 
  function boardList(){
	let url = '<%= contextPath %>/map/mapList';
	
	let fetchOptions = {
		method: 'GET',
	}
	
	try{
		//let response = await fetch( url + urlParams, fetchOptions);
		//let data = await response.json();
		//boardListArr = null;
		//boardListArr = data;
		let data = boardListArr;
		makeMapListHtml( data );
		console.log(data)
	}catch( error ){
		console.log(error);
		alert('이벤트 조회 과정에서 문제가 생겼습니다.')
	}
}
	
  async function boardList() {
			let url = '<%=contextPath%>/board/boardList';
			let urlParams = '?limit=' + LIST_ROW_COUNT + '&offset=' + OFFSET  + '&searchWord=' + SEARCH_WORD;
			//let urlParams = `?limit=${LIST_ROW_COUNT}&offset=${OFFSET}`; // jsp EL표기법과 javascript es6 literal template와 충돌.
		let fetchOptions = {
					method: 'GET',
			}
			
			try {
				let response = await fetch( url + urlParams, fetchOptions );
				let data = await response.json();
				console.log( data )
				makeListHtml( data );
				
				
			} catch( error ) {
				console.log(error);
				alertify.error('글 조회 과정에서 문제가 생겼습니다.');
			}
		}
  
  function makeMapListHtml(){
		let listHtml = ``;
		
		boardListArr.forEach( el => {

			let eventKey = el.eventKey;
			let name = el.name;
			let startDateTime = el.startDateTime;
			let endDateTime = el.endDateTime;
			
			listHtml += 
				`
					    <tr data-eventKey="\${eventKey}">
	      <td>\${name}</td>
	      <td>\${startDateTime} ~ \${endDateTime}</td>
	    </tr>
			`;
			
		});
		
		if(listHtml.length == 0)
			document.querySelector("#board-list > table > tbody").innerHTML = "진행중인 이벤트가 없습니다.";
		else {
			document.querySelector("#board-list > table > tbody").innerHTML = listHtml;
			makeListHtmlEventHandler();
		}
		
		
		//boardListTotalCnt();
	}
  function makeListHtmlEventHandler(){
		document.querySelectorAll("#board-list > table > tbody > tr").forEach( el => {
			el.onclick = function(){
				let no = this.getAttribute("data-eventKey");
				const item = boardListArr.find(el => el.eventKey == no);
				window.location.href="<%= contextPath%>/" + item.url;
				//makeDetailHtml(no);
			}
		})
	}
  
   	function makeDetailHtml(no){
   		const item = boardListArr.find(el => el.eventKey == no);	// boardListArr: 전역 변수 boardDto 리스트
   		
   		console.log(item)
   		console.log(no)
   		let url = item.url;
		let name = item.name;
   		
   		document.querySelector('#modal-body').innerHTML = `<h2>\${name}</h2><br>참여하기: \${url}<br>`
   		 
   	}
	    
	    
  </script>
</html>